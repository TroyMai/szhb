<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®ç®¡ç† - æ•°æ™ºæ¹–åŒ—</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="../public/css/common.css">
    <link rel="stylesheet" href="../public/css/components.css">
    <link rel="stylesheet" href="../public/css/footer.css">
</head>
<body class="bg-gray-50">
    <div id="header"></div>
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- è¿”å›é¦–é¡µæŒ‰é’® -->
        <div id="backButtonContainer"></div>
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <div class="flex justify-between items-center mb-4">
                <h1 class="text-2xl font-bold text-indigo-600">æ•°æ®ç®¡ç†</h1>
                <div class="flex items-center space-x-4">
                    <button id="importBtn" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">å¯¼å…¥æ•°æ®</button>
                    <button id="fetchBtn" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">ä»å¼€æ”¾ç½‘è·å–</button>
                </div>
            </div>
        </div>
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">æ•°æ®ç±»åˆ«</label>
                    <select id="categoryFilter" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                        <option>å…¨éƒ¨ç±»åˆ«</option>
                        <option>ç§‘æŠ€åˆ›æ–°</option>
                        <option>æ•™è‚²æ–‡åŒ–</option>
                        <option>ç¤¾ä¼šæ°‘ç”Ÿ</option>
                        <option>ç”Ÿæ€ç¯å¢ƒ</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">æ•°æ®çŠ¶æ€</label>
                    <select id="statusFilter" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                        <option>å…¨éƒ¨çŠ¶æ€</option>
                        <option>å·²å®¡æ ¸</option>
                        <option>å¾…å®¡æ ¸</option>
                        <option>å·²åˆ é™¤</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">æ›´æ–°æ—¶é—´</label>
                    <select id="timeFilter" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                        <option>å…¨éƒ¨æ—¶é—´</option>
                        <option>ä»Šå¤©</option>
                        <option>æœ¬å‘¨</option>
                        <option>æœ¬æœˆ</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">æœç´¢</label>
                    <input type="text" id="searchInput" placeholder="æœç´¢æ•°æ®åç§°..." class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                </div>
            </div>
            <div class="flex justify-between items-center">
                <div class="flex space-x-3">
                    <button id="batchApproveBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">æ‰¹é‡å®¡æ ¸</button>
                    <button id="batchExportBtn" class="px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700">æ‰¹é‡å¯¼å‡º</button>
                    <button id="batchDeleteBtn" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">æ‰¹é‡åˆ é™¤</button>
                </div>
                <div class="flex space-x-3">
                    <button id="resetBtn" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">é‡ç½®</button>
                    <button id="queryBtn" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">æŸ¥è¯¢</button>
                </div>
            </div>
        </div>
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-lg font-semibold text-gray-800">æ•°æ®åˆ—è¡¨</h2>
                <div class="flex items-center space-x-4">
                    <span class="text-sm text-gray-600">å…± <span id="totalCount" class="font-semibold text-indigo-600">0</span> æ¡æ•°æ®</span>
                    <select id="pageSize" class="px-3 py-1 border border-gray-300 rounded text-sm">
                        <option value="20">æ¯é¡µ20æ¡</option>
                        <option value="50">æ¯é¡µ50æ¡</option>
                        <option value="100">æ¯é¡µ100æ¡</option>
                    </select>
                </div>
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left"><input type="checkbox" id="selectAll" class="rounded border-gray-300"></th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ•°æ®åç§°</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ç±»åˆ«</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ•°æ®é‡</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">çŠ¶æ€</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ›´æ–°æ—¶é—´</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="dataTableBody" class="bg-white divide-y divide-gray-200"></tbody>
                </table>
            </div>
            <div id="pagination" class="mt-6 flex items-center justify-between"></div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600 mb-1">æ€»æ•°æ®é‡</p>
                        <p id="totalData" class="text-2xl font-bold text-gray-800">0</p>
                    </div>
                    <div class="text-3xl text-blue-500">ğŸ“Š</div>
                </div>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600 mb-1">å¾…å®¡æ ¸</p>
                        <p id="pendingData" class="text-2xl font-bold text-yellow-600">0</p>
                    </div>
                    <div class="text-3xl text-yellow-500">â³</div>
                </div>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600 mb-1">ä»Šæ—¥æ›´æ–°</p>
                        <p id="todayUpdate" class="text-2xl font-bold text-green-600">0</p>
                    </div>
                    <div class="text-3xl text-green-500">ğŸ”„</div>
                </div>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600 mb-1">æ•°æ®ç±»åˆ«</p>
                        <p id="categoryCount" class="text-2xl font-bold text-purple-600">0</p>
                    </div>
                    <div class="text-3xl text-purple-500">ğŸ“</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div id="footer"></div>

    <script type="module">
        import api from '../utils/api.js';
        import auth from '../utils/auth.js';
        import header from '../components/header.js';
        import common from '../utils/common.js';
        import backButton from '../components/backButton.js';
        import footer from '../components/footer.js';
        // æ£€æŸ¥ç™»å½•çŠ¶æ€å’Œæƒé™ï¼ˆä½¿ç”¨è·¯ç”±å®ˆå«ï¼‰
        const router = await import('../utils/router.js');
        router.default.beforeEnter('adminData');
        header.initHeader();
        backButton.initBackButton('backButtonContainer');
        footer.initFooter();
        const loadData = async () => {
            try {
                const response = await api.get('/data/list', {
                    category: document.getElementById('categoryFilter').value,
                    status: document.getElementById('statusFilter').value,
                    time: document.getElementById('timeFilter').value,
                    keyword: document.getElementById('searchInput').value
                });
                if (response.success) {
                    renderTable(response.data || []);
                    updateStats(response.stats || {});
                }
            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
            }
        };
        const renderTable = (data) => {
            const tbody = document.getElementById('dataTableBody');
            tbody.innerHTML = data.map(item => `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap"><input type="checkbox" class="data-checkbox rounded border-gray-300" value="${item.id}"></td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.category}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.count || 0}æ¡</td>
                    <td class="px-6 py-4 whitespace-nowrap"><span class="px-2 py-1 text-xs font-semibold rounded-full ${item.status === 'approved' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">${item.status === 'approved' ? 'å·²å®¡æ ¸' : 'å¾…å®¡æ ¸'}</span></td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${common.formatDate(item.updatedAt)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        <button class="text-indigo-600 hover:text-indigo-900 mr-3" onclick="editData('${item.id}')">ç¼–è¾‘</button>
                        <button class="text-blue-600 hover:text-blue-900 mr-3" onclick="viewData('${item.id}')">æŸ¥çœ‹</button>
                        ${item.status === 'pending' ? '<button class="text-green-600 hover:text-green-900 mr-3" onclick="approveData(\'' + item.id + '\')">å®¡æ ¸</button>' : ''}
                        <button class="text-red-600 hover:text-red-900" onclick="deleteData('${item.id}')">åˆ é™¤</button>
                    </td>
                </tr>
            `).join('');
        };
        const updateStats = (stats) => {
            document.getElementById('totalData').textContent = stats.total || 0;
            document.getElementById('pendingData').textContent = stats.pending || 0;
            document.getElementById('todayUpdate').textContent = stats.today || 0;
            document.getElementById('categoryCount').textContent = stats.categories || 0;
        };
        document.getElementById('queryBtn').addEventListener('click', loadData);
        document.getElementById('resetBtn').addEventListener('click', () => {
            document.getElementById('categoryFilter').value = '';
            document.getElementById('statusFilter').value = '';
            document.getElementById('timeFilter').value = '';
            document.getElementById('searchInput').value = '';
            loadData();
        });
        loadData();
    </script>
</body>
</html>

